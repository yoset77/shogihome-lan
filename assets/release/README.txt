ShogiHome LAN Engine - ユーザーガイド

本ソフトウェアは、ShogiHome (https://github.com/sunfish-shogi/shogihome) をフォークし、
LAN内でのリモートエンジン利用機能を追加した派生版です。

ShogiHome LAN Engine をご利用いただきありがとうございます。
このツールを使うと、PCの強力な将棋エンジンを、
同じWi-Fiにつながっているスマートフォンやタブレットから利用できるようになります。

==================================================================
【重要】セキュリティに関する注意
このツールは、自宅のWi-Fiなど「信頼できるネットワーク内」での利用を前提としています。
インターネットに直接公開するサーバー等では使用しないでください。
==================================================================

■ 1. 準備するもの

1.  このフォルダ一式（解凍済み）
2.  使いたい将棋エンジン
    ※ 後述する「engine_options.txt」の設定のため、YaneuraOuまたはFukauraOuを推奨します。

■ 2. 最初の設定

1.  将棋エンジンの配置
    エンジンの実行ファイルと評価関数を任意のフォルダに用意してください。
    ※ すでに使用しているエンジンに「engine_options.txt」を追加すると動作が変わる場合があるため、専用のフォルダを作成することを推奨します。

2.  エンジンの設定
    スレッド数やハッシュサイズといったエンジンオプションを設定ファイルに記述します。
    
    1. 各エンジンフォルダに「engine_options.txt」というファイルを、エンジンの設定（USIオプション）を記述して保存します。
       対局用エンジンは、NodesLimitを設定することを推奨します。
       具体的な記述方法は、やねうら王wiki(https://github.com/yaneurao/YaneuraOu/wiki/%E9%9A%A0%E3%81%97%E6%A9%9F%E8%83%BD)を参照してください。
     
       【重要】
       検討用エンジンの「MultiPV」（読み筋の数）の設定は、ShogiHomeアプリから行うため、
       このファイルには記述しないでください。

3.  「engines.json」ファイルの編集
    1. 「engine-wrapper」フォルダの中にある「engines.json」ファイルを、テキストエディタで開いて編集します。

       "id": 識別子です。
       "name": UI上に表示される名前です。
       "type": "research" "game" "both" のいずれかを指定してください。
       "path": エンジンのパスを記述してください。

       ※ JSONは文法が厳格に決まっているので、ブラウザ上のツールで文法をチェックするか、VS Code などの高機能エディタを使用してください。
    
    2. 「shogihome」フォルダの「.env」ファイルも同様にテキストエディタで編集します。
       以下の行を、ご自身のPCのIPアドレスに合わせて書き換えてください。
　　　 --------------------------------------------------
　　   # 接続を許可するオリジン（URLの一部）
       # 以下の設定は一例です
       ALLOWED_ORIGINS=http://localhost:8080,http://192.168.1.10:8080
       --------------------------------------------------

■ 3. 使い方

1.  起動する
    一番上のフォルダにある「start.bat」をダブルクリックしてください。
    黒い画面が開き、サーバーが起動します。

    【重要】初回起動時の許可について
    起動時に「Windows セキュリティ」のポップアップが表示された場合は、
    「プライベート ネットワーク」にチェックを入れて「アクセスを許可する」を押してください。
    ※現在のWi-Fiが「パブリック」設定になっていると通信できません。Windowsの設定から
      接続中のネットワークを「プライベート」に変更することを推奨します。

2.  スマホから使う
    PCと同じWi-Fiにつながっているスマホのブラウザ（ChromeやSafari）を開き、
    PCのIPアドレスを入力してアクセスします。
    モバイル版を表示する場合は、URLの末尾に「/?mobile」を付けると確実です。

    URLの例: http://192.168.1.10:8080/?mobile

■ 4. 終了方法

1.  起動時に開いた黒い画面（Web Server）を選択します。
2.  キーボードの「Ctrl」キーを押しながら「C」キーを押します。
    （または、単純にウィンドウの「×」ボタンで閉じてしまっても構いません）

■ 5. トラブルシューティング

Q. 画面が開かない / スマホからつながらない
A. 以下の2点を確認してください。

   1. Windowsのファイアウォール設定
      初回起動時のポップアップで「許可」をしなかった場合、通信がブロックされます。
      手動でWindowsファイアウォールの設定（「アプリにファイアウォール経由の通信を許可する」）を開き、
      「shogihome-server.exe」の通信を「プライベート」で許可してください。

   2. ネットワークの違い（二重ルーター等）
      PCとスマホが論理的に同じネットワークにいない可能性があります。
      PCとスマホのIPアドレスを見比べ、上3つの数字（例: 192.168.1.xxx の "192.168.1" 部分）が一致しているか確認してください。
      一致していない場合、二重ルーター環境などが原因で通信できない状態です。PCと同じWi-Fiにスマホを接続し直してみてください。

Q. エンジンが動かない / 検討ボタンを押しても反応がない
A. まず、サーバーを起動したPCのブラウザで「http://localhost:8080」にアクセスして検討ボタンを押してみてください。

   → ローカル（PC）では動くが、スマホからは動かない場合
   PCのIPアドレスと、「ALLOWED_ORIGINS」に書いたIPアドレスが一致しているか確認してください。

   → ローカル（PC）でも動かない場合
   「engine-wrapper」フォルダ内の「engines.json」の文法とエンジンのパスが正しいか確認してください。
   また、エンジンファイル（.exe）をダブルクリックして単体で起動できるか確認してください。
   「engine-wrapper」フォルダ内に生成される「engine-wrapper.log」ファイルにエラーの詳細が出力されている場合があるため、そちらもご確認ください。

■ 6. 応用

1.  インターネット経由でのアクセス (Tailscale)
    Tailscale(https://tailscale.com/download) を利用して、外部から安全にアクセスできます。

    1.  サーバーPCとクライアントにTailscaleをインストールし、同一アカウントでログインします。
    2.  Tailscaleが割り当てたサーバーPCのIPアドレス (100.x.x.x) を確認します。
    3.  クライアントから http://<TailscaleのIPアドレス>:8080 にアクセスします。

2.  HTTPS化とPWA化 (Tailscale Serve)
    tailscale serve を使うと、HTTPS化されたURLが発行され、PWAとしてホーム画面に追加できます。

    1.  サーバーPCで新たにターミナルを立ち上げ、以下のコマンドを実行します。
        --------------------------------------------------
        tailscale serve --bg 8080
        --------------------------------------------------

    2.  表示されたURL https://<hostname>.<tailnet>.ts.net を ALLOWED_ORIGINS に追加します。
        --------------------------------------------------
        ALLOWED_ORIGINS=http://localhost:8080,https://<hostname>.<tailnet>.ts.net
        --------------------------------------------------

    3.  (推奨)「shogihome」フォルダの「.env」ファイルに以下の行を追加することで、Tailscale経由のアクセスに限定できます。
        --------------------------------------------------
        BIND_ADDRESS=127.0.0.1
        --------------------------------------------------

    4.  サーバーを再起動します。
    5.  https://<hostname>.<tailnet>.ts.net にクライアントからアクセスし、「ホーム画面に追加」します。

==================================================================
このプロジェクトはMITライセンスのもと、オープンソースで開発されています。
詳細な情報は GitHub (https://github.com/yoset77/shogihome-lan) をご覧ください。

